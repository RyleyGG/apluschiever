<p-card [style]="{
  position: 'absolute',
  top: '0.75em',
  left: '0.75em',
}">
  <div style="
    display: flex; 
    align-items: center; 
    gap: 0.5em;
    padding: 0.5em;
  ">
    <!-- Course Name, Save, Publish, Increase Zoom, Decrease Zoom, Undo, Redo, -->
    <input pInputText type="text" id="nameInput" [(ngModel)]="courseName" />
    <p-divider layout="vertical" [style]="{ margin: '0 0.25em', padding: '12px 0.25em' }"></p-divider>
    <p-button styleClass="p-togglebutton" icon="pi pi-save" (click)="save()" pTooltip="Save" tooltipPosition="bottom" />
    <p-button styleClass="p-togglebutton" icon="pi pi-upload" (click)="publish()" pTooltip="Publish"
      tooltipPosition="bottom" />
    <p-button styleClass="p-togglebutton" icon="pi pi-undo" (click)="undo()" pTooltip="Undo" tooltipPosition="bottom" />
    <p-button styleClass="p-togglebutton" icon="pi pi-refresh" (click)="redo()" pTooltip="Redo"
      tooltipPosition="bottom" />
  </div>
</p-card>

<p-card [style]="{
  position: 'absolute',
  top: '0.75em',
  right: '0.75em',
}">
  <div style="
    display: flex; 
    align-items: center; 
    gap: 0.5em;
    padding: 0.5em;
  ">
    <p-toggleButton [(ngModel)]="enableEdits" onIcon="pi pi-lock-open" offIcon="pi pi-lock"
      [pTooltip]="enableEdits ? 'Disable Edits' : 'Enable Edits'" tooltipPosition="bottom" />
    <p-button styleClass="p-togglebutton" icon="pi pi-plus-circle" (onClick)="addLesson()" pTooltip="Add Lesson"
      tooltipPosition="bottom" />
    <p-toggleButton [(ngModel)]="addConnection" onIcon="pi pi-share-alt" offIcon="pi pi-share-alt"
      [pTooltip]="addConnection ? 'Disable Adding Connection' : 'Enable Adding Connection'" tooltipPosition="bottom" />
    <p-toggleButton [(ngModel)]="deleteElement" onIcon="pi pi-trash" offIcon="pi pi-trash"
      [pTooltip]="deleteElement ? 'Disable Deleting Element' : 'Enable Deleting Element'" tooltipPosition="bottom" />
  </div>
</p-card>


<!--This displays the graph of the course.-->
<graph #graphComponent class="course-view-graph-container" [edges]="this.edges" [nodes]="this.nodes"
  [clusters]="this.clusters" [layoutSettings]="courseViewGraphSettings" (nodeClicked)="onNodeClick($event)"
  (edgeClicked)="onEdgeClick($event)">
  <!--An override implementation of the edges so we can have a larger clickable area.-->
  <ng-template #edgeTemplate let-edge>
    <!-- Define marker for each edge -->
    <svg:defs>
      <svg:marker [attr.id]="'arrow-' + edge.id" [attr.viewBox]="'0 -10 20 20'" refX="8" refY="0" markerWidth="10"
        markerHeight="10" orient="auto">
        <svg:path [attr.fill]="edge.color" d="M 0 -10 L 10 0 L 0 10" />
      </svg:marker>
    </svg:defs>

    <!--Transparent larger area to click on-->
    <svg:path class="edge" stroke="transparent" stroke-width="30px" [attr.d]="edge.line" cursor="pointer" />

    <svg:path class="edge" [attr.stroke]="edge.color" [attr.marker-end]="'url(#arrow-' + edge.id + ')'"
      [attr.d]="edge.line" />
  </ng-template>
</graph>

<!--This is a dialog component to display whenever a node is clicked.-->
<p-dialog header="Header" [draggable]="false" [(visible)]="dialogVisible" [position]="'bottomright'"
  [style]="{ width: '33vw'}">
  <ng-template pTemplate="header">
    <div class="dialog-header">
      <ng-container *ngIf="enableEdits">
        <!--TODO: make below so that instead of an image, we show the image and clicking on it prompts for a new URL-->
        <div (click)="changeAvatarUrl()" style="cursor: pointer;">
          <p-avatar [image]="selectedAvatarUrl" shape="circle" />
        </div>
        <span class="p-float-label">
          <input pInputText type="text" id="nameInput" [(ngModel)]="selectedName" />
          <label for="nameInput">Lesson Name</label>
        </span>
      </ng-container>
      <ng-container *ngIf="!enableEdits">
        <p-avatar [image]="selectedAvatarUrl" shape="circle" />
        <span class="dialog-header-text">{{selectedNode.label}}</span>
      </ng-container>

    </div>
  </ng-template>
  <div style="display: flex; align-items: center; gap: 0.5em;">
    <ng-container *ngIf="enableEdits">
      <span class="p-float-label" style="margin-top: 1.25em; width: 100%;">
        <p-chips id="tags-input" [(ngModel)]="selectedTags" [style]="{ width: '100%', display: 'block' }"></p-chips>
        <label for="tags-input">Tags</label>
      </span>
    </ng-container>
    <ng-container *ngIf="!enableEdits">
      <p-tag *ngFor="let tag of selectedNode?.data.tags" value="{{tag}}"></p-tag>
    </ng-container>
  </div>
  <p class="m-0">

    <ng-container *ngIf="enableEdits">
      <span class="p-float-label" style="margin-top: 1.5em;">
        <textarea id="summary-input" rows="5" cols="30" pInputTextarea [(ngModel)]="selectedDescription"
          [autoResize]="true" [style]="{ width: '100%'}"></textarea>
        <label for="summary-input">Summary</label>
      </span>
    </ng-container>
    <ng-container *ngIf="!enableEdits">
      {{selectedNode?.data.short_description}}
    </ng-container>

  </p>
  <ng-template pTemplate="footer">
    <!--TODO: Have button to save changes and button for uploading content-->
    <p-button id="saveNodeButton" icon="pi pi-save" (click)="updateSelectedNodeData()" label="Save Changes" pAutoFocus
      [autofocus]="false" [style]="{ margin: '0', color: '--primary-color-text'}" />
  </ng-template>
</p-dialog>